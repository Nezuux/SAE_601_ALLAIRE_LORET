#https://github.com/Nezuux/SAE_601_ALLAIRE_LORET

# ðŸ“ **Instructions** :
# - Installez toutes les bibliothÃ¨ques nÃ©cessaires : conda create -n projet python pandas numpy matplotlib seaborn streamlit plotly
# - ComplÃ©tez les sections en Ã©crivant votre code oÃ¹ c'est indiquÃ©.
# - Ajoutez des commentaires clairs pour expliquer vos choix.
# - Utilisez des emoji avec windows + ;
# - InterprÃ©tez les rÃ©sultats de vos visualisations.

# Importation des bibliothÃ¨ques nÃ©cessaires
import pandas as pd  # pour la manipulation des donnÃ©es
import numpy as np  # pour les calculs numÃ©riques
import matplotlib.pyplot as plt  # pour crÃ©er des graphiques statiques
import seaborn as sns  # pour la visualisation de donnÃ©es statistique (plus avancÃ©e que matplotlib)
import streamlit as st  # pour crÃ©er l'application web interactive
import plotly.express as px  # pour crÃ©er des graphiques interactifs

# Configurer la page Streamlit
st.set_page_config(page_title="ðŸ§‘â€ðŸ’» Analyse des Salaires en Data Science", layout="wide")  # dÃ©finir le titre de la page et son layout

st.text("ALLAIRE Mathis & LORET Martin, Groupe D")  # afficher un texte de prÃ©sentation des auteurs

# Charger les donnÃ©es depuis un fichier CSV
df = pd.read_csv("ds_salaries.csv")  # lire le fichier CSV dans un DataFrame

# Titre de l'application Streamlit
st.title("ðŸ“Š Visualisation des Salaires en Data Science")  # titre principal de l'application

# Afficher un aperÃ§u des donnÃ©es
if st.checkbox("Afficher un aperÃ§u des donnÃ©es"):  # crÃ©er une case Ã  cocher
    st.write(df.head())  # afficher les 5 premiÃ¨res lignes du DataFrame

# Statistiques descriptives du DataFrame
st.subheader("ðŸ“Œ Statistiques gÃ©nÃ©rales")  # sous-titre de section
st.write(df.describe())  # afficher des statistiques comme la moyenne, Ã©cart-type, min, max, etc.

with st.expander("ðŸ’­ Analyse des statistiques gÃ©nÃ©rales"):  # zone de texte extensible
    st.markdown("""
    - Le jeu de donnÃ©es contient 3,755 entrÃ©es
    - Les annÃ©es couvertes vont de 2020 Ã  2023
    - La majoritÃ© des donnÃ©es sont de 2022-2023
    - Les donnÃ©es sont bien distribuÃ©es sur la pÃ©riode
    """)

# Distribution des salaires pour les personnes en France
df_france = df[df["company_location"] == "FR"]  # filtrer les donnÃ©es pour la France
fig1 = px.box(df_france, x="experience_level", y="salary_in_usd", color="experience_level", 
              title="Distribution des salaires par niveau d'expÃ©rience en France")  # graphique boxplot interactif
st.plotly_chart(fig1)  # afficher le graphique

with st.expander("ðŸ’­ Analyse de la distribution des salaires en France"):  # zone de texte extensible
    st.markdown("""
    - Les salaires augmentent avec le niveau d'expÃ©rience
    - Les seniors (SE) ont les salaires les plus Ã©levÃ©s
    - On observe une grande dispersion pour les niveaux expÃ©rimentÃ©s
    - Quelques valeurs atypiques sont prÃ©sentes
    """)

# Salaire moyen par catÃ©gorie (ex : par expÃ©rience, type d'emploi, etc.)
st.subheader("ðŸ“Š Salaire moyen par catÃ©gorie")  # sous-titre
category = st.selectbox("Choisir une catÃ©gorie", ['experience_level', 'employment_type', 'job_title', 'company_location'])  # menu dÃ©roulant pour sÃ©lectionner une catÃ©gorie
avg_salary = df.groupby(category)['salary_in_usd'].mean()  # calculer le salaire moyen par catÃ©gorie
st.bar_chart(avg_salary)  # afficher un graphique Ã  barres

with st.expander("ðŸ’­ Analyse des tendances de salaires"):  # zone de texte extensible
    st.markdown("""
    - Les salaires varient significativement selon les catÃ©gories
    - Les postes Ã  temps plein sont mieux rÃ©munÃ©rÃ©s
    - Certains pays offrent des salaires nettement supÃ©rieurs
    - Les Data Scientists seniors sont les mieux payÃ©s
    """)

# Calculer les corrÃ©lations entre les variables numÃ©riques
st.subheader("ðŸ”— CorrÃ©lations entre variables numÃ©riques")  # sous-titre
numeric_df = df.select_dtypes(include=[np.number])  # sÃ©lectionner uniquement les colonnes numÃ©riques
correlation_matrix = numeric_df.corr()  # calculer la matrice de corrÃ©lation
fig, ax = plt.subplots(figsize=(10, 8))  # crÃ©er un graphique avec une taille dÃ©finie
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', ax=ax)  # afficher la carte de chaleur des corrÃ©lations
st.pyplot(fig)  # afficher le graphique dans Streamlit

with st.expander("ðŸ’­ Analyse des corrÃ©lations"):  # zone de texte extensible
    st.markdown("""
    - Certaines variables montrent des corrÃ©lations fortes
    - Le salaire est fortement corrÃ©lÃ© avec le niveau d'expÃ©rience
    - La taille de l'entreprise a un impact modÃ©rÃ© sur les salaires
    """)

# Analyse interactive de l'Ã©volution des salaires par poste
st.subheader("ðŸ“ˆ Ã‰volution des salaires par poste")  # sous-titre
top_jobs = df["job_title"].value_counts().head(10).index  # obtenir les 10 titres de poste les plus frÃ©quents
df_top_jobs = df[df["job_title"].isin(top_jobs)]  # filtrer les donnÃ©es pour ces 10 postes
salary_trend = df_top_jobs.groupby(["work_year", "job_title"])["salary_in_usd"].mean().reset_index()  # calculer le salaire moyen par annÃ©e et poste

fig4 = px.line(salary_trend, x="work_year", y="salary_in_usd", color="job_title", 
               title="Tendance des salaires pour les 10 postes les plus courants")  # crÃ©er un graphique linÃ©aire interactif
fig4.update_xaxes(dtick=1, tickformat="d")  # ajuster les axes x
st.plotly_chart(fig4)  # afficher le graphique interactif

with st.expander("ðŸ’­ Analyse des variations de salaire"):  # zone de texte extensible
    st.markdown("""
    - Les salaires ont tendance Ã  augmenter au fil des annÃ©es
    - Certains postes montrent une croissance plus rapide
    - La disparitÃ© entre les postes s'accentue avec le temps
    """)

# Salaire mÃ©dian par expÃ©rience et taille d'entreprise
st.subheader("ðŸ“Š Salaire mÃ©dian par expÃ©rience et taille d'entreprise")  # sous-titre

median_salary = df.groupby(["experience_level", "company_size"])["salary_in_usd"].median().reset_index()  # calculer le salaire mÃ©dian

fig5 = px.bar(median_salary, x="experience_level", y="salary_in_usd", color="company_size",
              title="Salaire mÃ©dian par niveau d'expÃ©rience et taille d'entreprise")  # crÃ©er un graphique en barres interactif
st.plotly_chart(fig5)  # afficher le graphique

with st.expander("ðŸ’­ Analyse des salaires mÃ©dians"):  # zone de texte extensible
    st.markdown("""
    - Les grandes entreprises offrent gÃ©nÃ©ralement de meilleurs salaires
    - L'Ã©cart de salaire entre les niveaux d'expÃ©rience est plus marquÃ© dans les grandes entreprises
    - Les petites entreprises montrent moins de variation entre les niveaux
    """)

# Ajout de filtres dynamiques sur les salaires
st.subheader("ðŸŽ›ï¸ Filtrage dynamique des salaires")  # sous-titre

salary_range = st.slider("SÃ©lectionnez la plage de salaire", min_value=25000, max_value=175000, value=(25000, 175000))  # crÃ©er un curseur pour filtrer par salaire
df_filtered = df[(df["salary_in_usd"] >= salary_range[0]) & (df["salary_in_usd"] <= salary_range[1])]  # filtrer les donnÃ©es en fonction du salaire sÃ©lectionnÃ©

st.write(f"Nombre d'observations aprÃ¨s filtrage : {len(df_filtered)}")  # afficher le nombre de donnÃ©es restantes aprÃ¨s filtrage
st.write(df_filtered.head())  # afficher les premiÃ¨res lignes du DataFrame filtrÃ©

with st.expander("ðŸ’­ Analyse du filtrage"):  # zone de texte extensible
    st.markdown("""
    - Le filtrage permet d'identifier les segments spÃ©cifiques
    - La majoritÃ© des salaires se situe dans une plage moyenne
    - Certains postes sortent des plages habituelles
    """)

# Analyse de l'impact du tÃ©lÃ©travail sur les salaires selon le pays
st.subheader("ðŸ¡ Impact du tÃ©lÃ©travail sur le salaire selon le pays")  # sous-titre

telework_impact = df.groupby(["remote_ratio", "company_location"])["salary_in_usd"].mean().reset_index()  # calculer l'impact du tÃ©lÃ©travail par pays

fig6 = px.bar(telework_impact, x="company_location", y="salary_in_usd", color="remote_ratio",
              title="Impact du tÃ©lÃ©travail sur les salaires")  # crÃ©er un graphique en barres interactif
st.plotly_chart(fig6)  # afficher le graphique

with st.expander("ðŸ’­ Analyse de l'impact du tÃ©lÃ©travail"):  # zone de texte extensible
    st.markdown("""
    - Le tÃ©lÃ©travail complet offre souvent des salaires plus Ã©levÃ©s
    - L'impact varie selon les pays
    - Certains pays privilÃ©gient le travail hybride
    """)

# Filtrage avancÃ© des donnÃ©es par niveau d'expÃ©rience et taille d'entreprise
st.subheader("ðŸ” Filtrage avancÃ©")  # sous-titre

exp_levels = st.multiselect("SÃ©lectionnez le niveau d'expÃ©rience", df["experience_level"].unique())  # multi-sÃ©lection pour le niveau d'expÃ©rience
company_sizes = st.multiselect("SÃ©lectionnez la taille d'entreprise", df["company_size"].unique())  # multi-sÃ©lection pour la taille d'entreprise

df_filtered_advanced = df  # copie du DataFrame original
if exp_levels:  # si des niveaux d'expÃ©rience sont sÃ©lectionnÃ©s
    df_filtered_advanced = df_filtered_advanced[df_filtered_advanced["experience_level"].isin(exp_levels)]  # filtrer par niveaux
if company_sizes:  # si des tailles d'entreprise sont sÃ©lectionnÃ©es
    df_filtered_advanced = df_filtered_advanced[df_filtered_advanced["company_size"].isin(company_sizes)]  # filtrer par taille d'entreprise

st.write(f"Nombre d'observations aprÃ¨s filtrage avancÃ© : {len(df_filtered_advanced)}")  # afficher le nombre de donnÃ©es aprÃ¨s filtrage avancÃ©
st.write(df_filtered_advanced.head())  # afficher les premiÃ¨res lignes du DataFrame filtrÃ©

with st.expander("ðŸ’­ Analyse des statistiques gÃ©nÃ©rales"):  # zone de texte extensible
    st.markdown("""
    - Le jeu de donnÃ©es contient exactement 3,755 entrÃ©es
    - Les annÃ©es couvertes vont de 2020 Ã  2023
    - La moyenne des annÃ©es est d'environ 2022.37, indiquant que la majoritÃ© des donnÃ©es sont rÃ©centes
    - 50% des donnÃ©es se situent en 2022
    - Les donnÃ©es sont principalement concentrÃ©es sur 2022-2023
    - On observe une forte prÃ©sence de profils seniors (SE) dans les donnÃ©es rÃ©centes
    """)

# Afficher les 5 jobs les mieux payÃ©s
job_salaries = df.groupby('job_title')['salary_in_usd'].mean().sort_values(ascending=False)  # calculer et trier par salaire moyen

# SÃ©lectionner les top 5 jobs
top_5_jobs = job_salaries.head(5)  # obtenir les 5 meilleurs salaires

# CrÃ©er un DataFrame pour l'affichage
top_5_df = pd.DataFrame({
    'Job Title': top_5_jobs.index,  # titres des postes
    'Average Salary (USD)': top_5_jobs.values  # salaires moyens
})

# Afficher le tableau dans Streamlit
st.subheader("Top 5 des jobs les mieux payÃ©s")  # sous-titre
st.table(top_5_df)  # afficher le tableau des jobs et salaires

with st.expander("ðŸ’­ Analyse des jobs les mieux payÃ©s"):  # zone de texte extensible
    st.markdown("""
    - On retrouve le job Data Science Tech Lead qui est le mieux payÃ©
    - Le job Data Science Tech Lead est 1,9 fois plus payÃ© que Principal Data Scientist
    - Il y a beaucoup de diffÃ©rence entre les salaires
    """)
